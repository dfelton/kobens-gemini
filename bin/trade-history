#!/bin/bash

#
# Trade History Processes
#

ENV_FILE="$(realpath $(dirname $BASH_SOURCE))/.env"
[ ! -f $ENV_FILE ] && echo >&2 "No \"$ENV_FILE\" file found" && exit 1
source $ENV_FILE

for pair in "${SYMBOLS[@]}"
do
    ps aux | grep -v grep | grep -q "$(realpath $(dirname $BASH_SOURCE))/gemini logger:trade-history $pair"
    if [ $? -eq 1 ]
    then
        php -n $(realpath $(dirname $BASH_SOURCE))/gemini logger:trade-history $pair &
        # by staggering the start time we reduce risk of running into rate limits
        sleep 2
    fi
done
